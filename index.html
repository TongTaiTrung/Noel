<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>2 Tháng của chúng ta</title>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Fonts */
      @import url("https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;400;600&family=Dancing+Script:wght@500&display=swap");

      :root {
        --sat: env(safe-area-inset-top);
        --sab: env(safe-area-inset-bottom);
      }

      body {
        margin: 0; background-color: #050505; color: white;
        font-family: "Montserrat", sans-serif; overflow-x: hidden;
        -webkit-tap-highlight-color: transparent;
      }

      /* Cursor Logic */
      @media (pointer: fine) {
        body { cursor: none !important; }
        a, button, [role="button"], .group { cursor: none !important; }
      }
      @media (pointer: coarse) {
        body { cursor: auto !important; }
        .desktop-only { display: none !important; }
      }

      .cinzel { font-family: "Cinzel", serif; }
      .handwriting { font-family: "Dancing Script", cursive; }

      /* Background Canvas */
      #canvas-bg, #canvas-dust { 
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
        pointer-events: none; will-change: transform;
      }
      #canvas-bg { z-index: -2; background: radial-gradient(circle at center, #1e0d36 0%, #000000 100%); }
      #canvas-dust { z-index: 1000; }

      /* Masonry Layout (Pinterest Style) */
      .masonry-container {
        columns: 1; gap: 1.5rem; padding: 15px;
      }
      @media (min-width: 768px) { .masonry-container { columns: 2; gap: 2rem; } }
      @media (min-width: 1024px) { .masonry-container { columns: 3; } }

      .masonry-item {
        break-inside: avoid; margin-bottom: 2rem; display: block;
      }

      /* Card Effects */
      .glass-panel {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .shine-effect {
        position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
        background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.2), transparent);
        transform: skewX(-25deg); pointer-events: none;
      }
      @media (hover: hover) {
        .group:hover .shine-effect { animation: shine 0.7s forwards; }
      }
      @keyframes shine { from { left: -100%; } to { left: 150%; } }

      /* Typewriter Cursor */
      .cursor-blink::after {
        content: "|"; animation: blink 1s step-start infinite;
        margin-left: 2px; color: #f472b6;
      }
      @keyframes blink { 50% { opacity: 0; } }
      
      .modal-blur {
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      }

      ::-webkit-scrollbar { width: 0; }
    </style>
  </head>
  <body>
    <canvas id="canvas-bg"></canvas>
    <canvas id="canvas-dust"></canvas>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef, useMemo } = React;
      const { motion, AnimatePresence, useMotionValue, useSpring } = window.Motion;

      // DATA (Giữ nguyên)
      const memories = [
        { id: 1, src: "/textures/img7.jpg", note: "Tấm hình kỷ niệm đầu tiên của hai mình.", date: "21/10/2025" },
        { id: 2, src: "/textures/img1.jpg", note: "Những ngày khi chúng ta còn bỡ ngỡ khi bắt chuyện với nhau.", date: "22/10/2025" },
        { id: 3, src: "/textures/img6.jpg", note: "Lúc ra về nhưng lại không muốn rời xa em.", date: "25/10/2025" },
        { id: 4, src: "/textures/img4.jpg", note: "Buổi đi chơi giống như hẹn hò vậy, anh cứ nhớ mãi.", date: "14/11/2025" },
        { id: 5, src: "/textures/img8.jpg", note: "Món quà em tặng anh nhân ngày International Men's Day.", date: "19/11/2025" },
        { id: 6, src: "/textures/img9.png", note: "Em lại đến bên anh với một bất ngờ. Có lẽ trước đó anh đã không nói, nhưng món quà của em khiến anh xúc động rất nhiều!", date: "19/11/2025" },
        { id: 7, src: "/textures/img2.jpg", note: "Mỗi giây phút bên em, đối với anh đó đều là những món quà.", date: "20/11/2025" },
      ];

      // --- Custom Cursor ---
      const GlowCursor = () => {
        const mouseX = useMotionValue(-100);
        const mouseY = useMotionValue(-100);
        const springConfig = { damping: 25, stiffness: 300 };
        const x = useSpring(mouseX, springConfig);
        const y = useSpring(mouseY, springConfig);

        useEffect(() => {
          const moveCursor = (e) => { mouseX.set(e.clientX); mouseY.set(e.clientY); };
          window.addEventListener("mousemove", moveCursor);
          return () => window.removeEventListener("mousemove", moveCursor);
        }, []);

        return (
          <div className="desktop-only pointer-events-none fixed inset-0 z-[9999]">
            <motion.div style={{ x, y, translateX: "-50%", translateY: "-50%" }} className="w-2 h-2 bg-white rounded-full mix-blend-difference" />
            <motion.div style={{ x, y, translateX: "-50%", translateY: "-50%" }} className="w-12 h-12 bg-pink-500/30 rounded-full blur-xl" />
          </div>
        );
      };

      // --- Rotating Text Effect ---
      const RotatingText = () => {
        const quotes = useMemo(() => [
          "Cảm ơn em vì đã đến bên anh...",
          "Mỗi khoảnh khắc là một điều kỳ diệu...",
          "Yêu em nhiều hơn mỗi ngày...",
          "Our journey has just begun...",
        ], []);
        const [text, setText] = useState("");
        const [isDeleting, setIsDeleting] = useState(false);
        const [loopNum, setLoopNum] = useState(0);
        const [delta, setDelta] = useState(100);

        useEffect(() => {
          let ticker = setInterval(() => {
            tick();
          }, delta);
          return () => clearInterval(ticker);
        }, [text, delta]);

        const tick = () => {
          let i = loopNum % quotes.length;
          let fullText = quotes[i];
          let updatedText = isDeleting ? fullText.substring(0, text.length - 1) : fullText.substring(0, text.length + 1);

          setText(updatedText);

          if (isDeleting) setDelta(40);

          if (!isDeleting && updatedText === fullText) {
            setIsDeleting(true);
            setDelta(2000); // Wait before deleting
          } else if (isDeleting && updatedText === "") {
            setIsDeleting(false);
            setLoopNum(loopNum + 1);
            setDelta(100);
          }
        };

        return <span className="cursor-blink">{text}</span>;
      };

      // --- Background Particles ---
      const UniverseBackground = () => {
        useEffect(() => {
          const canvasBg = document.getElementById("canvas-bg");
          const canvasDust = document.getElementById("canvas-dust");
          const ctxBg = canvasBg.getContext("2d");
          const ctxDust = canvasDust.getContext("2d");
          let width, height, stars = [], particles = [];
          
          const resize = () => {
            width = window.innerWidth; height = window.innerHeight;
            canvasBg.width = width; canvasBg.height = height;
            canvasDust.width = width; canvasDust.height = height;
            const isMobile = width < 768;
            stars = Array.from({ length: isMobile ? 60 : 150 }, () => ({ x: Math.random() * width, y: Math.random() * height, size: Math.random() * 1.5, opacity: Math.random(), fadeDir: 0.005 }));
            // Particles moving towards screen (3D effect simulation)
            particles = Array.from({ length: isMobile ? 30 : 80 }, () => ({ x: (Math.random() - 0.5) * width, y: (Math.random() - 0.5) * height, z: Math.random() * width }));
          };
          window.addEventListener("resize", resize); resize();

          const animate = () => {
            // Stars Layer
            ctxBg.clearRect(0, 0, width, height);
            stars.forEach(s => {
              ctxBg.fillStyle = `rgba(255, 255, 255, ${s.opacity})`;
              ctxBg.beginPath(); ctxBg.arc(s.x, s.y, s.size, 0, Math.PI * 2); ctxBg.fill();
              s.opacity += s.fadeDir; 
              if (s.opacity > 1 || s.opacity < 0.2) s.fadeDir = -s.fadeDir;
            });

            // Dust Layer (Warp Effect)
            ctxDust.clearRect(0, 0, width, height);
            const cx = width / 2; const cy = height / 2;
            particles.forEach(p => {
              p.z -= 2; if (p.z <= 0) p.z = width; // Move forward
              const scale = 300 / (p.z);
              const px = cx + p.x * scale;
              const py = cy + p.y * scale;
              const radius = (1 - p.z / width) * 3;
              
              if (px >= 0 && px <= width && py >= 0 && py <= height) {
                ctxDust.fillStyle = `rgba(244, 114, 182, ${1 - p.z / width})`; // Pinkish dust
                ctxDust.beginPath(); ctxDust.arc(px, py, radius, 0, Math.PI * 2); ctxDust.fill();
              }
            });
            requestAnimationFrame(animate);
          };
          animate();
        }, []);
        return null;
      };

      // --- Alive Card (Grid Item) ---
      const AliveCard = ({ item, onSelect }) => {
        // Random slight rotation for organic feel
        const rotation = useMemo(() => (Math.random() - 0.5) * 4, []);
        
        return (
          <div className="masonry-item">
            <motion.div
              layoutId={`card-${item.id}`} // Key for Morphing Magic
              whileHover={{ scale: 1.02, rotate: 0, zIndex: 10 }}
              whileTap={{ scale: 0.98 }}
              initial={{ opacity: 0, y: 50 }}
              whileInView={{ opacity: 1, y: 0, rotate: rotation }}
              viewport={{ once: true, margin: "-10%" }}
              transition={{ duration: 0.5 }}
              onClick={() => onSelect(item)}
              className="relative rounded-2xl overflow-hidden glass-panel cursor-pointer group shadow-lg"
            >
              {/* Shine Effect Overlay */}
              <div className="shine-effect" />
              
              <motion.img 
                layoutId={`img-${item.id}`}
                src={item.src} 
                className="w-full h-auto object-cover block opacity-90 group-hover:opacity-100 transition-opacity" 
                alt="Memory"
              />
              
              <div className="absolute bottom-0 left-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent pt-12">
                <motion.p layoutId={`date-${item.id}`} className="cinzel text-[10px] text-pink-400 font-bold tracking-widest uppercase mb-1">
                  {item.date}
                </motion.p>
                <p className="text-xs text-white/80 line-clamp-1 italic font-light">{item.note}</p>
              </div>
            </motion.div>
          </div>
        );
      };

      // --- Morphing Modal ---
      const Modal = ({ selected, onClose }) => {
        return (
          <motion.div 
            initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}
            className="fixed inset-0 z-[2000] flex items-center justify-center p-4 modal-blur"
            onClick={onClose}
          >
            {/* Main Card Container */}
            <motion.div 
              layoutId={`card-${selected.id}`}
              className="relative w-full max-w-5xl bg-[#111] rounded-3xl overflow-hidden flex flex-col md:flex-row shadow-2xl border border-white/10 max-h-[85vh]"
              onClick={(e) => e.stopPropagation()}
            >
              
              {/* Image Section */}
              <div className="md:w-3/5 bg-black/50 relative flex items-center justify-center overflow-hidden">
                <motion.img 
                  layoutId={`img-${selected.id}`}
                  src={selected.src} 
                  className="w-full h-full object-contain max-h-[50vh] md:max-h-full"
                />
              </div>

              {/* Text Section */}
              <div className="md:w-2/5 p-8 flex flex-col bg-zinc-900/80 backdrop-blur-md relative">
                <button 
                  onClick={onClose}
                  className="absolute top-4 right-4 w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-white/50 hover:bg-white/20 hover:text-white transition-colors"
                >
                  ✕
                </button>

                <div className="mt-2 mb-6">
                  <motion.span layoutId={`date-${selected.id}`} className="cinzel text-pink-500 text-xs font-bold tracking-[0.2em] uppercase">
                    {selected.date}
                  </motion.span>
                </div>

                <div className="overflow-y-auto pr-2 custom-scroll">
                  <motion.div 
                    initial={{ opacity: 0, y: 20 }} 
                    animate={{ opacity: 1, y: 0 }} 
                    transition={{ delay: 0.2 }}
                    className="handwriting text-2xl md:text-3xl text-gray-100 leading-relaxed"
                  >
                    "{selected.note}"
                  </motion.div>
                </div>

                <motion.div 
                  initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }}
                  className="mt-auto pt-6 border-t border-white/5 flex items-center gap-2"
                >
                  <div className="w-2 h-2 rounded-full bg-pink-500 animate-pulse" />
                  <span className="text-[10px] text-white/30 uppercase tracking-widest">Memory Logged</span>
                </motion.div>
              </div>

            </motion.div>
          </motion.div>
        );
      };

      const App = () => {
        const [selected, setSelected] = useState(null);

        return (
          <>
            <GlowCursor />
            <UniverseBackground />
            
            <main className="relative z-10 w-full min-h-screen pb-10">
              {/* Header */}
              <section className="min-h-[70vh] flex flex-col items-center justify-center text-center px-4">
                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 1 }}>
                  <h1 className="cinzel text-5xl md:text-8xl font-bold bg-clip-text text-transparent bg-gradient-to-br from-white via-pink-200 to-pink-500 mb-6 drop-shadow-2xl">
                    Eternal Love
                  </h1>
                  <div className="h-8 flex items-center justify-center">
                    <p className="text-pink-300/80 text-sm md:text-lg tracking-[0.3em] font-light uppercase">
                      <RotatingText />
                    </p>
                  </div>
                </motion.div>
                
                <motion.div 
                  animate={{ y: [0, 10, 0], opacity: [0.3, 1, 0.3] }} 
                  transition={{ duration: 2, repeat: Infinity }} 
                  className="absolute bottom-10"
                >
                  <span className="text-[10px] text-white/30 uppercase tracking-widest">Scroll Down</span>
                </motion.div>
              </section>

              {/* Masonry Grid */}
              <section className="max-w-7xl mx-auto px-4 md:px-8">
                <div className="masonry-container">
                  {memories.map((item, index) => (
                    <AliveCard key={item.id} item={item} index={index} onSelect={setSelected} />
                  ))}
                </div>
              </section>
            </main>

            <AnimatePresence>
              {selected && <Modal selected={selected} onClose={() => setSelected(null)} />}
            </AnimatePresence>
          </>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>